<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>テキスト保存＆リンク起動PWA</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <style>
    :root { color-scheme: light dark; }
    *{box-sizing:border-box}
    html,body{margin:0;background:#0b1020;color:#e5e7eb;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
    input, textarea, select { font-size:16px !important; }
    .wrap{max-width:960px;margin:0 auto;padding:16px 16px 96px}
    h1{font-size:18px;margin:12px 0 8px;font-weight:700}
    .card{background:#0f172a;border:1px solid #23324d;border-radius:16px;padding:12px}
    textarea{
      width:100%;min-height:140px;border:1px solid #2b3b5a;border-radius:12px;
      background:#0b1222;color:#e5e7eb;padding:12px;outline:none;resize:vertical;font-size:16px !important;
    }
    .row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid #263755;background:#16233d;color:#e5e7eb;
      padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:600;font-size:15px;
      transition:transform .02s ease,opacity .2s ease;user-select:none
    }
    .btn:active{transform:scale(.98)}
    .btn.copy{background:#1e3a8a;border-color:#3655a8}
    .grid{
      display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px
    }
    @media (min-width:560px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (min-width:840px){ .grid{grid-template-columns:repeat(4,1fr)} }
    .linkbtn{
      display:block;text-align:center;text-decoration:none;color:#e5e7eb;background:#17253f;
      border:1px solid #2a3e62;border-radius:14px;padding:16px;min-height:64px;
      font-weight:700;line-height:1.2;word-break:break-word
    }
    .hint{opacity:.7;font-size:12px;margin-top:6px}
    /* トースト */
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:#111827;color:#e5e7eb;border:1px solid #374151;
      padding:10px 14px;border-radius:999px;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:2000
    }
    .toast.show{opacity:1}
    /* 安全領域 */
    @supports (padding: max(0px)) {
      .wrap{padding-bottom: max(96px, env(safe-area-inset-bottom))}
    }
    code{background:#111826;border:1px solid #26324a;border-radius:6px;padding:2px 6px}
    a.inline{color:#9ec5ff}
    label.chk{display:inline-flex;gap:.5rem;align-items:center;cursor:pointer}
    input[type="checkbox"]{width:18px;height:18px}
    input[type="url"]{
      width:100%;margin-top:6px;border:1px solid #2b3b5a;border-radius:10px;
      background:#0b1222;color:#e5e7eb;padding:10px;font-size:16px !important;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>メモ（自動保存・ワンタップコピー）</h1>
    <div class="card">
      <textarea id="memo" placeholder="ここにテキストを入力…（入力と同時に自動保存されます）" aria-label="メモ入力欄"></textarea>
      <div class="row">
        <button id="copyBtn" class="btn copy" aria-label="メモをコピー">このテキストをコピー</button>
        <button id="clearBtn" class="btn" title="内容のみ消去（保存領域は残ります）" aria-label="メモを消去">消去</button>
      </div>
      <div class="hint">
        URLで初期文を設定：<code>?text=初期テキスト</code>
      </div>
    </div>

    <h1>リンク起動（URLパラメータで定義可）</h1>
    <div id="links" class="grid" aria-label="リンクボタン一覧">
      <!-- app.js が生成 -->
    </div>
    <div class="card hint">
      例）<code>?btn=X|https://46memorybit.github.io/SNSPWA/X/index.html&amp;btn=歌ネット|https://www.uta-net.com/song/382246/&amp;btn=USEN|https://usen.oshireq.com/song/6299592</code><br/>
      <small>※ <strong>btn=タイトル|URL</strong> を複数回指定。<code>|</code> は区切り。</small>
    </div>

    <!-- 共有用URL生成：ページ最下部 -->
    <h1>共有用URL生成</h1>
    <div class="card">
      <label style="display:block;margin-bottom:8px;">
        ベースURL（パラメータなし）
        <input id="baseUrl" type="url" inputmode="url" value="https://46memorybit.github.io/sns/index.html" aria-label="ベースURL入力" />
      </label>

      <div class="row" style="margin-top:0">
        <label class="chk btn">
          <input id="optText" type="checkbox" checked />
          <span>text= を含める（メモの内容）</span>
        </label>
        <label class="chk btn">
          <input id="optBtns" type="checkbox" checked />
          <span>btn= を含める（現在のリンクボタン）</span>
        </label>
      </div>

      <div style="margin-top:10px">
        <textarea id="shareUrl" readonly rows="3"
          style="width:100%;border:1px solid #2b3b5a;border-radius:12px;background:#0b1222;color:#e5e7eb;padding:12px;resize:vertical;font-size:14px"
          aria-label="生成された共有URL表示欄"></textarea>
        <div class="row">
          <button id="genBtn" class="btn" aria-label="URLを再生成">URLを再生成</button>
          <button id="copyShareBtn" class="btn copy" aria-label="URLをコピー">URLをコピー</button>
        </div>
        <div class="hint">
          生成例：<code>?text=...&amp;btn=タイトル%7Chttps%3A%2F%2Fexample.com&amp;btn=...</code>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="./db.js"></script>
  <script src="./app.js"></script>
  <script>
    // Service Worker 登録
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
